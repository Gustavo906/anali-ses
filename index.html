<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROSTATS APEX | Neural Learning Terminal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap');
        :root { --bg: #050505; --card: #0d0d10; --border: #1f1f23; --ai: #3b82f6; --brain: #a855f7; }
        body { background-color: var(--bg); color: #d1d1d6; font-family: 'Inter', sans-serif; margin: 0; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .glass-card { 
            background: var(--card); 
            border: 1px solid var(--border); 
            border-radius: 16px; 
            padding: 20px; 
            transition: all 0.2s ease; 
            cursor: pointer; 
        }
        .glass-card:hover { border-color: var(--ai); transform: translateY(-2px); background: #111115; }
        
        .date-tag {
            font-size: 10px;
            font-weight: 800;
            padding: 2px 8px;
            border-radius: 4px;
            background: #1a1a1e;
            color: #64748b;
            border: 1px solid #27272a;
        }
        .tag-today { color: #10b981; border-color: rgba(16, 185, 129, 0.2); background: rgba(16, 185, 129, 0.05); }

        .rank-badge { background: #16161a; border: 1px solid #27272a; font-size: 10px; font-weight: 700; padding: 2px 6px; border-radius: 4px; }
        
        #modal { backdrop-filter: blur(15px); z-index: 9999; }
        .log-box { background: #000; border: 1px solid #1f1f23; font-size: 9px; padding: 10px; border-radius: 8px; max-height: 120px; overflow-y: auto; color: #a855f7; }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- TOP NAVIGATION -->
    <nav class="h-16 border-b border-zinc-800 bg-black px-6 flex items-center justify-between sticky top-0 z-[100]">
        <div class="flex items-center gap-4">
            <h1 class="text-sm font-black tracking-tighter uppercase text-white">APEX <span class="text-blue-500 italic">NEURAL</span></h1>
            <div class="h-4 w-[1px] bg-zinc-800 hidden md:block"></div>
            <div class="hidden lg:flex flex-col">
                <span class="text-[8px] mono text-purple-400 font-bold uppercase tracking-widest">Self-Learning Active</span>
                <div class="w-24 h-1 bg-zinc-800 rounded-full mt-1 overflow-hidden">
                    <div id="brainBar" class="h-full bg-purple-500 transition-all duration-1000" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <select id="leagueSelect" onchange="syncData()" class="bg-zinc-900 border border-zinc-700 text-[10px] font-bold px-3 py-2 rounded-lg text-white outline-none focus:ring-1 ring-blue-500">
            <option value="BSA">BRASILEIRÃO SÉRIE A</option>
            <option value="PL">PREMIER LEAGUE</option>
            <option value="CL">CHAMPIONS LEAGUE (48H)</option>
            <option value="PD">LA LIGA</option>
            <option value="SA">SERIE A</option>
        </select>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="flex-1 p-6 lg:p-10 max-w-7xl mx-auto w-full">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-10">
            
            <!-- LISTA DE JOGOS -->
            <div class="lg:col-span-3">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl font-black text-white tracking-tight uppercase italic">Radar de Eventos</h2>
                    <div class="text-[10px] mono text-zinc-500 font-bold uppercase tracking-widest bg-zinc-900 px-3 py-1 rounded-full border border-zinc-800">
                        Scanner: <span id="matchCount">0</span> jogos detectados
                    </div>
                </div>
                <div id="grid" class="grid grid-cols-1 md:grid-cols-2 gap-5"></div>
                <div id="empty" class="hidden py-40 text-center text-zinc-700 italic">Nenhum evento na janela de tempo especificada.</div>
            </div>

            <!-- PAINEL DE APRENDIZADO -->
            <div class="space-y-6">
                <h2 class="text-lg font-bold text-white mb-6 uppercase tracking-tighter">Status da Rede</h2>
                <div class="bg-zinc-900/40 p-6 rounded-2xl border border-zinc-800">
                    <p class="text-[10px] mono text-zinc-500 uppercase mb-4">Registro de Auto-Ajuste</p>
                    <div id="learnLog" class="log-box mono uppercase leading-loose">
                        <div>> Sincronizando rede neural...</div>
                    </div>
                </div>
                <div class="bg-blue-600/5 p-6 rounded-2xl border border-blue-600/20">
                    <p class="text-[10px] mono text-blue-400 uppercase mb-1 font-bold">Confiança do Modelo</p>
                    <h3 id="globalConfidence" class="text-3xl font-black text-white italic">--%</h3>
                </div>
                <button onclick="localStorage.clear(); location.reload();" class="w-full py-4 bg-zinc-900 border border-zinc-800 text-[10px] font-bold uppercase rounded-xl hover:bg-red-900/20 transition-all text-zinc-600 hover:text-red-400">Resetar Conhecimento</button>
            </div>
        </div>
    </main>

    <!-- MODAL DE ANÁLISE -->
    <div id="modal" class="fixed inset-0 hidden flex items-center justify-center p-4 bg-black/95">
        <div class="w-full max-w-4xl bg-[#0a0a0c] border border-zinc-800 rounded-[40px] overflow-hidden flex flex-col shadow-2xl max-h-[95vh]">
            <div class="p-6 border-b border-zinc-800 flex justify-between items-center bg-zinc-900/40">
                <div class="flex items-center gap-4">
                    <span class="text-[10px] mono font-bold text-blue-500 uppercase tracking-widest">Deep Neural Analytics</span>
                    <span id="mDateHeader" class="date-tag"></span>
                </div>
                <button onclick="closeModal()" class="text-zinc-500 text-3xl hover:text-white transition-all">&times;</button>
            </div>
            <div class="p-8 lg:p-12 overflow-y-auto" id="modalContent">
                <!-- Injetado via JS -->
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '8e3c0eba984c46a090a5c53c37835285';
        const PROXY = "https://corsproxy.io/?";
        let engine = { table: [], leagueAvg: 0 };

        // HELPER DE DATA INTELIGENTE
        function formatMatchDate(utcDate) {
            const date = new Date(utcDate);
            const now = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(now.getDate() + 1);

            const time = date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            
            if (date.toDateString() === now.toDateString()) {
                return { label: 'HOJE', time: time, class: 'tag-today' };
            } else if (date.toDateString() === tomorrow.toDateString()) {
                return { label: 'AMANHÃ', time: time, class: '' };
            } else {
                const dayMonth = date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                return { label: dayMonth, time: time, class: '' };
            }
        }

        // SISTEMA DE APRENDIZADO
        function getBrain() {
            const b = localStorage.getItem('apex_brain_v4');
            return b ? JSON.parse(b) : { learnedMatches: [], teamBias: {}, totalProcessed: 0 };
        }

        function saveBrain(b) {
            localStorage.setItem('apex_brain_v4', JSON.stringify(b));
            updateNeuralStats();
        }

        async function autoLearn(league) {
            const log = document.getElementById('learnLog');
            const brain = getBrain();
            try {
                const res = await fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/matches?status=FINISHED`, { headers: {'X-Auth-Token': API_KEY}});
                const data = await res.json();
                let count = 0;

                data.matches.forEach(m => {
                    if (brain.learnedMatches.includes(m.id)) return;
                    const hId = m.homeTeam.id, aId = m.awayTeam.id;
                    const sh = m.score.fullTime.home, sa = m.score.fullTime.away;
                    
                    if (sh > sa) { brain.teamBias[hId] = (brain.teamBias[hId] || 1) * 1.05; brain.teamBias[aId] = (brain.teamBias[aId] || 1) * 0.95; }
                    else if (sa > sh) { brain.teamBias[aId] = (brain.teamBias[aId] || 1) * 1.05; brain.teamBias[hId] = (brain.teamBias[hId] || 1) * 0.95; }
                    
                    brain.learnedMatches.push(m.id);
                    brain.totalProcessed++;
                    count++;
                });

                if (count > 0) { log.innerHTML += `<div>> +${count} resultados incorporados.</div>`; saveBrain(brain); }
                else log.innerHTML += `<div>> Rede atualizada (0 novos).</div>`;
            } catch (e) { log.innerHTML += `<div class="text-red-500">> Falha na sincronização.</div>`; }
        }

        // SYNC PRINCIPAL
        async function syncData() {
            const league = document.getElementById('leagueSelect').value;
            const grid = document.getElementById('grid');
            grid.innerHTML = `<div class="col-span-full py-20 text-center mono text-[10px] animate-pulse text-blue-500 uppercase tracking-[0.4em]">Iniciando Scan de Radar...</div>`;
            
            autoLearn(league);

            try {
                const [resS, resM] = await Promise.all([
                    fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/standings`, { headers: {'X-Auth-Token': API_KEY}}),
                    fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/matches?status=SCHEDULED`, { headers: {'X-Auth-Token': API_KEY}})
                ]);

                const sD = await resS.json();
                const mD = await resM.json();

                engine.table = league === 'CL' ? sD.standings.flatMap(g => g.table) : sD.standings[0].table;
                let tg = 0, tj = 0;
                engine.table.forEach(t => { tg += t.goalsFor; tj += t.playedGames; });
                engine.leagueAvg = tg / (tj || 1);

                const now = new Date();
                const limit = new Date();
                limit.setHours(now.getHours() + (league === 'CL' ? 48 : 96));

                const filtered = mD.matches.filter(m => { const d = new Date(m.utcDate); return d >= now && d <= limit; });
                document.getElementById('matchCount').innerText = filtered.length;

                if (filtered.length === 0) { grid.innerHTML = ""; document.getElementById('empty').classList.remove('hidden'); return; }

                document.getElementById('empty').classList.add('hidden');
                grid.innerHTML = filtered.map(m => {
                    const h = engine.table.find(t => t.team.id === m.homeTeam.id);
                    const a = engine.table.find(t => t.team.id === m.awayTeam.id);
                    const dateInfo = formatMatchDate(m.utcDate);

                    return `
                    <div onclick="runAnalysis(${m.homeTeam.id}, ${m.awayTeam.id}, '${m.utcDate}')" class="glass-card">
                        <div class="flex justify-between items-center mb-6">
                            <div class="date-tag ${dateInfo.class}">${dateInfo.label} às ${dateInfo.time}</div>
                            <div class="flex gap-2">
                                <span class="rank-badge">${h ? h.position : '?'}º</span>
                                <span class="rank-badge text-blue-500">${a ? a.position : '?'}º</span>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <img src="${m.homeTeam.crest}" class="w-6 h-6 object-contain">
                                    <span class="text-xs font-black uppercase text-white tracking-tighter">${m.homeTeam.shortName}</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <img src="${m.awayTeam.crest}" class="w-6 h-6 object-contain">
                                    <span class="text-xs font-black uppercase text-white tracking-tighter">${m.awayTeam.shortName}</span>
                                </div>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            } catch (e) { grid.innerHTML = `<div class="col-span-full py-10 text-red-500 text-center mono text-xs uppercase">Erro crítico no Pipeline.</div>`; }
        }

        function factorial(n) { return n <= 1 ? 1 : n * factorial(n - 1); }
        function poisson(k, lambda) { return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k); }

        function runAnalysis(hId, aId, utcDate) {
            const h = engine.table.find(t => t.team.id === hId);
            const a = engine.table.find(t => t.team.id === aId);
            if(!h || !a) return;

            const brain = getBrain();
            const hBias = brain.teamBias[hId] || 1;
            const aBias = brain.teamBias[aId] || 1;
            const dateInfo = formatMatchDate(utcDate);

            const xGH = ((h.goalsFor/h.playedGames)/engine.leagueAvg) * ((a.goalsAgainst/a.playedGames)/engine.leagueAvg) * engine.leagueAvg * 1.15 * hBias;
            const xGA = ((a.goalsFor/a.playedGames)/engine.leagueAvg) * ((h.goalsAgainst/h.playedGames)/engine.leagueAvg) * engine.leagueAvg * aBias;

            let pH = 0, pD = 0, pA = 0, maxP = 0, bestS = "";
            for(let i=0; i<6; i++) {
                for(let j=0; j<6; j++) {
                    const p = poisson(i, xGH) * poisson(j, xGA);
                    if(i > j) pH += p; else if(i === j) pD += p; else pA += p;
                    if(p > maxP) { maxP = p; bestS = `${i} - ${j}`; }
                }
            }

            document.getElementById('mDateHeader').innerText = `${dateInfo.label} às ${dateInfo.time}`;
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modalContent').innerHTML = `
                <div class="flex flex-col md:flex-row items-center justify-between gap-10 mb-16 pb-16 border-b border-zinc-900 text-center">
                    <div class="flex-1">
                        <div class="text-4xl font-black text-white italic mb-2">${h.position}º</div>
                        <img src="${h.team.crest}" class="w-24 h-24 mx-auto mb-6">
                        <h4 class="text-xl font-black uppercase text-white">${h.team.shortName}</h4>
                    </div>
                    <div class="px-8 text-center">
                        <p class="text-[10px] mono text-zinc-500 uppercase mb-4 tracking-[0.3em]">Score Projetado</p>
                        <div class="text-8xl font-black italic text-white tracking-tighter">${bestS}</div>
                        <p class="text-[10px] mono text-purple-400 mt-6 uppercase font-bold">Auto-Correct Bias: ${((hBias-1)*100).toFixed(1)}%</p>
                    </div>
                    <div class="flex-1">
                        <div class="text-4xl font-black text-white italic mb-2">${a.position}º</div>
                        <img src="${a.team.crest}" class="w-24 h-24 mx-auto mb-6">
                        <h4 class="text-xl font-black uppercase text-white">${a.team.shortName}</h4>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                    <div class="bg-blue-600/5 border-l-4 border-blue-600 p-8 rounded-r-[32px]">
                        <h5 class="text-xs font-bold text-blue-500 uppercase mono mb-4">Veredito da Rede Neural</h5>
                        <p class="text-lg italic text-zinc-200 leading-relaxed font-medium">Com base no ajuste de bias de ${hBias.toFixed(2)}x aplicado ao ${h.team.shortName}, o modelo aponta uma chance de ${(pH*100).toFixed(0)}% para a vitória do mandante. A tabela e o momento sugerem que este é o cenário de maior valor matemático.</p>
                    </div>
                    <div class="bg-zinc-900/40 p-10 rounded-[40px] border border-zinc-800 grid grid-cols-3 gap-6 text-center">
                        <div><span class="text-[9px] text-zinc-500 block uppercase mb-2">Win Casa</span><span class="text-2xl font-black text-blue-500">${(pH*100).toFixed(1)}%</span></div>
                        <div><span class="text-[9px] text-zinc-500 block uppercase mb-2">Empate</span><span class="text-2xl font-black text-zinc-500">${(pD*100).toFixed(1)}%</span></div>
                        <div><span class="text-[9px] text-zinc-500 block uppercase mb-2">Win Fora</span><span class="text-2xl font-black text-white">${(pA*100).toFixed(1)}%</span></div>
                    </div>
                </div>`;
        }

        function updateNeuralStats() {
            const b = getBrain();
            document.getElementById('brainBar').style.width = Math.min(b.totalProcessed * 2, 100) + '%';
            document.getElementById('globalConfidence').innerText = (85 + (b.totalProcessed * 0.1)).toFixed(1) + '%';
        }

        function closeModal() { document.getElementById('modal').classList.add('hidden'); document.body.style.overflow = 'auto'; }
        window.onload = () => { syncData(); updateNeuralStats(); };
    </script>
</body>
</html>
