<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROSTATS APEX | Titan v38.0 Identity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap');
        :root { --bg: #030305; --panel: #0a0a0c; --border: #1a1a1e; --ai-blue: #3b82f6; --emerald: #10b981; }
        body { background-color: var(--bg); color: #d1d1d6; font-family: 'Inter', sans-serif; margin: 0; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Grid de Jogos Responsivo */
        .data-card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 14px; cursor: pointer; transition: 0.2s; position: relative; }
        .data-card:hover { border-color: var(--ai-blue); background: #0c0c11; transform: translateY(-2px); }
        
        /* Nomes no Grid com Auto-Ajuste */
        .grid-name { 
            font-size: clamp(9px, 2vw, 11px); 
            font-weight: 800; 
            color: #fff; 
            text-transform: uppercase; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis;
            display: block;
            width: 100%;
        }

        /* Modal Layout Lado a Lado */
        .modal-header-pro { display: grid; grid-template-columns: 1fr 80px 1fr; align-items: center; gap: 10px; width: 100%; text-align: center; }
        .score-box { font-family: 'JetBrains Mono'; font-weight: 800; color: #fff; line-height: 1; white-space: nowrap; }
        
        .history-tag { 
            font-size: 7px; 
            font-weight: 700; 
            padding: 2px 5px; 
            border-radius: 4px; 
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.05);
            margin-top: 4px;
            display: inline-block;
            max-width: 90px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .report-box { border-left: 3px solid var(--ai-blue); background: linear-gradient(90deg, rgba(59, 130, 246, 0.05) 0%, rgba(0,0,0,0) 100%); padding: 15px; border-radius: 0 12px 12px 0; margin-bottom: 10px; font-size: 13px; }

        #modal { backdrop-filter: blur(40px); z-index: 10000; display: none; }
        #modal.active { display: flex; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- NAV -->
    <nav class="h-16 border-b border-zinc-800 bg-black/90 px-6 flex items-center justify-between sticky top-0 z-[1000]">
        <h1 class="text-sm font-black tracking-widest text-white uppercase italic">APEX <span class="text-blue-500">TITAN v38</span></h1>
        <select id="leagueSelect" onchange="initApp()" class="bg-zinc-900 border border-zinc-800 text-[10px] font-bold px-3 py-2 rounded-xl text-white outline-none">
            <option value="PL">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø PREMIER LEAGUE</option>
            <option value="BSA">üáßüá∑ BRASILEIR√ÉO A</option>
            <option value="PD">üá™üá∏ LA LIGA</option>
            <option value="SA">üáÆüáπ SERIE A</option>
            <option value="BL1">üá©üá™ BUNDESLIGA</option>
            <option value="CL">üá™üá∫ CHAMPIONS LEAGUE</option>
        </select>
    </nav>

    <main class="flex-1 p-4 lg:p-10 max-w-7xl mx-auto w-full">
        <header class="mb-8">
            <h2 class="text-2xl font-black text-white uppercase italic">Radar de Decis√£o</h2>
            <p id="statusMsg" class="text-zinc-600 text-[10px] mono uppercase tracking-widest italic">Iniciando estudo de dados...</p>
        </header>

        <!-- Grid Responsivo: 1 col mobile, 2 col tablet, 3 col desktop -->
        <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
        <div id="empty" class="hidden py-40 text-center text-zinc-700 mono text-[11px] uppercase italic">Buscando novas partidas...</div>
    </main>

    <!-- MODAL DE AN√ÅLISE -->
    <div id="modal" class="fixed inset-0 items-center justify-center p-2 md:p-4 bg-black/95 overflow-hidden">
        <div class="w-full max-w-5xl bg-[#08080a] border border-white/5 rounded-[2rem] shadow-2xl flex flex-col max-h-[95vh]">
            
            <div class="p-4 border-b border-white/5 flex justify-between items-center bg-zinc-900/10">
                <span class="text-[9px] font-black text-blue-400 uppercase tracking-widest">Relat√≥rio Bilateral Titan</span>
                <button onclick="closeModal()" class="text-zinc-500 hover:text-white text-2xl px-2">&times;</button>
            </div>

            <div class="p-6 md:p-10 overflow-y-auto">
                <!-- CABE√áALHO LADO A LADO FIXO -->
                <div class="modal-header-pro mb-8 pb-8 border-b border-zinc-900">
                    <div class="flex flex-col items-center min-w-0">
                        <img id="mLogoH" class="w-8 h-8 mb-2 object-contain">
                        <div id="mNameH" class="grid-name text-center">--</div>
                        <div id="mPosH" class="text-[7px] text-zinc-600 font-bold uppercase mt-1">--</div>
                        <div id="mLastH" class="history-tag">--</div>
                    </div>
                    
                    <div class="flex flex-col items-center justify-center">
                        <p class="text-[7px] mono text-zinc-500 uppercase mb-1 font-black italic">Previs√£o</p>
                        <div id="mScore" class="score-box text-3xl md:text-5xl text-white italic">0 - 0</div>
                        <div id="mConf" class="text-[7px] font-black text-emerald-400 mono mt-2 px-2 py-0.5 bg-emerald-400/10 rounded-full border border-emerald-400/20 uppercase">CALIBRADO</div>
                    </div>

                    <div class="flex flex-col items-center min-w-0">
                        <img id="mLogoA" class="w-8 h-8 mb-2 object-contain">
                        <div id="mNameA" class="grid-name text-center">--</div>
                        <div id="mPosA" class="text-[7px] text-zinc-600 font-bold uppercase mt-1">--</div>
                        <div id="mLastA" class="history-tag">--</div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                    <!-- ANALYTICS -->
                    <div class="lg:col-span-4 space-y-6">
                        <h5 class="text-[10px] font-black text-zinc-500 uppercase italic">Probabilidades Reais</h5>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-[9px] font-bold uppercase mb-1"><span class="text-blue-500">Vit√≥ria Casa</span><span id="mProbH">0%</span></div>
                                <div class="data-bar-bg"><div id="mBarH" class="data-bar-fill bg-blue-600 shadow-[0_0_10px_#3b82f6]"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-[9px] font-bold uppercase mb-1"><span class="text-zinc-500">Empate</span><span id="mProbD">0%</span></div>
                                <div class="data-bar-bg"><div id="mBarD" class="data-bar-fill bg-zinc-600"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-[9px] font-bold uppercase mb-1"><span class="text-white">Vit√≥ria Fora</span><span id="mProbA">0%</span></div>
                                <div class="data-bar-bg"><div id="mBarA" class="data-bar-fill bg-white shadow-[0_0_10px_#fff]"></div></div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="bg-white/5 p-3 rounded-xl border border-white/5 text-center">
                                <span class="block text-[7px] text-zinc-500 font-bold mb-1 uppercase">Ambas Marcam</span>
                                <span id="mBTTS" class="text-base font-black text-emerald-500 mono italic">0%</span>
                            </div>
                            <div class="bg-white/5 p-3 rounded-xl border border-white/5 text-center">
                                <span class="block text-[7px] text-zinc-500 font-bold mb-1 uppercase">Over 2.5</span>
                                <span id="mO25" class="text-base font-black text-white mono italic">0%</span>
                            </div>
                        </div>
                    </div>

                    <!-- TEXTOS -->
                    <div class="lg:col-span-8 space-y-4">
                        <h5 class="text-[10px] font-black text-zinc-500 uppercase italic">Dedu√ß√£o T√°tica Multigentes</h5>
                        <div class="report-box" id="mAnalisysH" style="color: #bfdbfe;"></div>
                        <div class="report-box" id="mAnalisysA" style="border-color: #f4f4f5; color: #e4e4e7;"></div>
                        <div id="mVerdict" class="p-6 rounded-[1.5rem] text-center border font-black uppercase text-xl italic shadow-2xl transition-all duration-700">--</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '8e3c0eba984c46a090a5c53c37835285';
        const PROXY = "https://corsproxy.io/?";
        let engine = { table: [], leagueAvg: 2.6, realHistory: {} };

        // DICION√ÅRIO DE IDENTIDADE ULTRA-R√ÅPIDO (v38)
        function cleanName(name) {
            if (!name) return "";
            const shortMap = {
                "Wolverhampton Wanderers": "Wolves",
                "Manchester United": "Man United",
                "Manchester City": "Man City",
                "Tottenham Hotspur": "Tottenham",
                "Leicester City": "Leicester",
                "West Ham United": "West Ham",
                "Newcastle United": "Newcastle",
                "Nottingham Forest": "Nottingham",
                "Sheffield United": "Sheffield",
                "Brighton & Hove Albion": "Brighton",
                "Atl√©tico de Madrid": "Atl. Madrid",
                "Athletic Club": "Athletic",
                "Real Sociedad": "R. Sociedad",
                "Rayo Vallecano": "Rayo",
                "Borussia M√∂nchengladbach": "Gladbach",
                "Bayer 04 Leverkusen": "Leverkusen",
                "Eintracht Frankfurt": "Eintracht",
                "Paris Saint-Germain": "PSG",
                "Olympique de Marseille": "Marseille",
                "Sporting CP": "Sporting",
                "Red Bull Salzburg": "Salzburg",
                "Sociedade Esportiva Palmeiras": "Palmeiras",
                "Clube Atl√©tico Mineiro": "Atl√©tico-MG",
                "Club de Regatas Vasco da Gama": "Vasco",
                "Fluminense FC": "Fluminense",
                "Athletico Paranaense": "Athletico-PR",
                "Red Bull Bragantino": "Bragantino",
                "Atl√©tico Goianiense": "Atl√©tico-GO",
                "Fortaleza Esporte Clube": "Fortaleza"
            };

            if(shortMap[name]) return shortMap[name];

            return name
                .replace(/\s+FC$|\s+CF$|\s+CD$|\s+SSC$|\s+AS$|\s+United$|\s+City$|\s+Wanderers$|\s+Hotspur$|\s+Athletic$|\s+Atl√©tico$|\s+Club$|\s+EC$|\s+SAF$|\s+AC$|\s+SC$|\s+SSC$|\s+SE$|\s+CR$/gi, '')
                .trim();
        }

        function factorial(n) { return n <= 1 ? 1 : n * factorial(n - 1); }
        function poisson(k, lambda) { return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k); }

        async function studyMatches(league) {
            try {
                const res = await fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/matches?status=FINISHED`, { headers: {'X-Auth-Token': API_KEY}});
                const data = await res.json();
                if(!data.matches) return;
                data.matches.slice(-50).forEach(m => {
                    const hId = m.homeTeam.id, aId = m.awayTeam.id;
                    const hRes = m.score.fullTime.home > m.score.fullTime.away ? 'V' : (m.score.fullTime.home === m.score.fullTime.away ? 'E' : 'D');
                    const aRes = m.score.fullTime.away > m.score.fullTime.home ? 'V' : (m.score.fullTime.home === m.score.fullTime.away ? 'E' : 'D');
                    if(!engine.realHistory[hId]) engine.realHistory[hId] = [];
                    if(!engine.realHistory[aId]) engine.realHistory[aId] = [];
                    engine.realHistory[hId].push({ score: `${m.score.fullTime.home}x${m.score.fullTime.away}`, opp: cleanName(m.awayTeam.name), res: hRes });
                    engine.realHistory[aId].push({ score: `${m.score.fullTime.away}x${m.score.fullTime.home}`, opp: cleanName(m.homeTeam.name), res: aRes });
                });
            } catch (e) { console.warn("Estudo offline."); }
        }

        async function initApp() {
            const league = document.getElementById('leagueSelect').value;
            const grid = document.getElementById('grid');
            const status = document.getElementById('statusMsg');
            
            grid.innerHTML = "";
            status.innerText = "ESTUDANDO PERFORMANCE RECENTE...";

            try {
                await studyMatches(league);
                status.innerText = "SINCRO DE DADOS...";

                const [resS, resM] = await Promise.all([
                    fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/standings`, { headers: {'X-Auth-Token': API_KEY}}),
                    fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/matches?status=SCHEDULED`, { headers: {'X-Auth-Token': API_KEY}})
                ]);

                const sD = await resS.json(); const mD = await resM.json();
                if(!sD.standings) throw new Error();

                engine.table = sD.standings[0].table;
                let tg = 0, tj = 0;
                engine.table.forEach(t => { tg += t.goalsFor; tj += t.playedGames; });
                engine.leagueAvg = tg / (tj || 1);

                status.innerText = "AN√ÅLISE TITAN CONCLU√çDA";

                grid.innerHTML = mD.matches.slice(0, 15).map(m => {
                    const h = engine.table.find(t => t.team.id === m.homeTeam.id);
                    const a = engine.table.find(t => t.team.id === m.awayTeam.id);
                    if(!h || !a) return '';
                    const d = new Date(m.utcDate);
                    return `
                    <div onclick="openAnalysis(${m.homeTeam.id}, ${m.awayTeam.id}, '${m.utcDate}')" class="data-card">
                        <div class="flex justify-between items-center mb-4 text-[9px] mono text-zinc-600 font-bold uppercase">
                            <span>${d.toLocaleDateString('pt-BR')} ‚Ä¢ ${d.toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'})}</span>
                            <span class="text-blue-500">TITAN v38</span>
                        </div>
                        <div class="flex items-center justify-between gap-2">
                            <div class="flex items-center gap-2 min-w-0 flex-1">
                                <img src="${m.homeTeam.crest}" class="w-6 h-6 object-contain">
                                <span class="grid-name">${cleanName(m.homeTeam.name)}</span>
                            </div>
                            <div class="px-1 italic text-[9px] opacity-20 font-black">VS</div>
                            <div class="flex items-center gap-2 min-w-0 flex-1 justify-end">
                                <span class="grid-name text-right">${cleanName(m.awayTeam.name)}</span>
                                <img src="${m.awayTeam.crest}" class="w-6 h-6 object-contain">
                            </div>
                        </div>
                    </div>`;
                }).join('');
            } catch (e) { status.innerText = "ERRO: LIMITE DE API (AGUARDE 60S)"; }
        }

        function openAnalysis(hId, aId, dateStr) {
            const h = engine.table.find(t => t.team.id === hId);
            const a = engine.table.find(t => t.team.id === aId);
            if(!h || !a) return;

            const hAtk = (h.goalsFor / h.playedGames) / engine.leagueAvg;
            const aDef = (a.goalsAgainst / a.playedGames) / engine.leagueAvg;
            const aAtk = (a.goalsFor / a.playedGames) / engine.leagueAvg;
            const hDef = (h.goalsAgainst / h.playedGames) / engine.leagueAvg;
            
            const hPPG = h.points / h.playedGames, aPPG = a.points / a.playedGames;
            const hAdv = (hPPG > aPPG * 1.1) ? 1.04 : 1.02;

            let xGH = hAtk * aDef * engine.leagueAvg * hAdv;
            let xGA = aAtk * hDef * engine.leagueAvg;

            let pH=0, pD=0, pA=0, btts=0, o25=0, maxP = -1, bestS = "0-0";
            for(let i=0; i<7; i++) {
                for(let j=0; j<7; j++) {
                    const prob = poisson(i, xGH) * poisson(j, xGA);
                    if(i > j) pH += prob; else if(i === j) pD += prob; else pA += prob;
                    if(i > 0 && j > 0) btts += prob;
                    if(i + j > 2.5) o25 += prob;
                    if(prob > maxP) { maxP = prob; bestS = i + " - " + j; }
                }
            }

            document.getElementById('modal').classList.add('active');
            document.getElementById('mScore').innerText = bestS;
            document.getElementById('mLogoH').src = h.team.crest;
            document.getElementById('mLogoA').src = a.team.crest;
            document.getElementById('mNameH').innerText = cleanName(h.team.name);
            document.getElementById('mNameA').innerText = cleanName(a.team.name);
            document.getElementById('mPosH').innerText = h.position + "¬∫ Rank";
            document.getElementById('mPosA').innerText = a.position + "¬∫ Rank";

            const lastH = (engine.realHistory[hId] || []).slice(-1)[0] || {score: 'N/A', opp: '?', res: '?'};
            const lastA = (engine.realHistory[aId] || []).slice(-1)[0] || {score: 'N/A', opp: '?', res: '?'};
            document.getElementById('mLastH').innerText = `√öltimo: ${lastH.score} vs ${lastH.opp}`;
            document.getElementById('mLastA').innerText = `√öltimo: ${lastA.score} vs ${lastA.opp}`;

            const upd = (id, val, barId = null) => {
                const el = document.getElementById(id);
                el.innerText = (val * 100).toFixed(1) + '%';
                if(barId) document.getElementById(barId).style.width = (val * 100) + '%';
            };
            upd('mProbH', pH, 'mBarH'); upd('mProbD', pD, 'mBarD'); upd('mProbA', pA, 'mBarA');
            upd('mBTTS', btts); upd('mO25', o25);

            document.getElementById('mAnalisysH').innerText = `Dedu√ß√£o Mandante: O ${cleanName(h.team.name)} apresenta efici√™ncia ofensiva de ${hAtk.toFixed(1)}x. Vindo de um resultado de ${lastH.score}, a IA projetou um volume t√°tico de ${(xGH).toFixed(2)} gols para este evento.`;
            document.getElementById('mAnalisysA').innerText = `Dedu√ß√£o Visitante: O ${cleanName(a.team.name)} sustenta PPG de ${aPPG.toFixed(2)}. Sua m√©dia defensiva cede ${(a.goalsAgainst/a.playedGames).toFixed(2)} gols por partida. Probabilidade de vit√≥ria real: ${(pA*100).toFixed(0)}%.`;

            const diff = Math.abs(pH - pA);
            let verd = "", color = "";
            if (diff < 0.13) { verd = "EMPATE OU VIT√ìRIA"; color = "border-zinc-700 text-zinc-400 bg-zinc-900"; }
            else if (pH > pA) { verd = "VIT√ìRIA MANDANTE"; color = "border-blue-500 text-blue-500 bg-blue-500/10"; }
            else { verd = "VIT√ìRIA VISITANTE"; color = "border-white text-white bg-white/10"; }
            
            const vB = document.getElementById('mVerdict');
            vB.innerText = verd; vB.className = `p-6 rounded-[1.5rem] text-center border font-black uppercase text-xl italic shadow-2xl ${color}`;
        }

        function closeModal() { document.getElementById('modal').classList.remove('active'); }
        window.onload = initApp;
    </script>
</body>
</html>
