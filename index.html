<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROSTATS APEX | Intelig√™ncia Quantitativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;400;700;900&display=swap');
        
        :root { --neon: #22d3ee; --dark-bg: #020617; }
        body { background: var(--dark-bg); color: #cbd5e1; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(34, 211, 238, 0.1); }
        .input-neural { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); color: white; transition: 0.3s; }
        .input-neural:focus { border-color: var(--neon); box-shadow: 0 0 15px rgba(34, 211, 238, 0.2); outline: none; }
        
        .scanline { position: absolute; inset: 0; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%); background-size: 100% 4px; pointer-events: none; opacity: 0.3; }
        .heatmap-cell { aspect-ratio: 1; border-radius: 2px; display: flex; align-items: center; justify-content: center; font-size: 8px; font-weight: bold; font-family: 'JetBrains Mono'; }
        
        .btn-neon { background: transparent; border: 1px solid var(--neon); color: var(--neon); transition: 0.4s; cursor: pointer; }
        .btn-neon:hover { background: var(--neon); color: black; box-shadow: 0 0 20px var(--neon); }

        .date-badge { font-size: 9px; padding: 2px 8px; border-radius: 4px; font-weight: 800; border: 1px solid; text-transform: uppercase; }
        .badge-today { background: rgba(34, 211, 238, 0.1); color: var(--neon); border-color: rgba(34, 211, 238, 0.4); }
        .badge-tomorrow { background: rgba(251, 191, 36, 0.1); color: #fbbf24; border-color: rgba(251, 191, 36, 0.4); }
        .badge-future { background: rgba(255, 255, 255, 0.05); color: #94a3b8; border-color: rgba(255, 255, 255, 0.1); }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--neon); border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen">

    <!-- AUTENTICA√á√ÉO -->
    <div id="authSection" class="fixed inset-0 z-[9999] bg-slate-950 flex items-center justify-center p-4">
        <div class="glass w-full max-w-md p-8 rounded-[32px] relative overflow-hidden">
            <div class="scanline"></div>
            <div class="text-center mb-10">
                <h1 class="text-4xl font-black italic tracking-tighter text-white uppercase">Pro<span class="text-cyan-400">Stats</span></h1>
                <p id="authSubtitle" class="mono text-[10px] text-cyan-400/60 uppercase tracking-[0.4em] mt-2">Acesso ao Terminal</p>
            </div>

            <div class="space-y-4">
                <div id="registerFields" class="hidden space-y-4">
                    <label class="text-[10px] mono text-slate-500 ml-1 uppercase">Nome de Operador</label>
                    <input type="text" id="regName" class="input-neural w-full p-4 rounded-xl text-xs font-bold" placeholder="EX: ANA COSTA">
                </div>
                
                <div class="space-y-1">
                    <label class="text-[10px] mono text-slate-500 ml-1 uppercase">E-mail</label>
                    <input type="email" id="authEmail" class="input-neural w-full p-4 rounded-xl text-xs font-bold" placeholder="seu@email.com">
                </div>

                <div class="space-y-1">
                    <label class="text-[10px] mono text-slate-500 ml-1 uppercase">Senha</label>
                    <input type="password" id="authPass" class="input-neural w-full p-4 rounded-xl text-xs font-bold" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                
                <button onclick="handleAuth()" id="mainBtn" class="btn-neon w-full py-4 rounded-xl font-black text-xs uppercase tracking-widest mt-4">
                    Acessar Terminal
                </button>
                
                <p onclick="toggleAuth()" id="toggleText" class="text-center text-[10px] mono text-slate-500 hover:text-cyan-400 cursor-pointer uppercase tracking-widest mt-6">
                    Novo operador? Criar conta
                </p>
            </div>
        </div>
    </div>

    <!-- DASHBOARD -->
    <div id="appContainer" class="hidden">
        <header class="max-w-7xl mx-auto p-6 md:p-10 flex flex-col md:flex-row justify-between items-center gap-6">
            <div>
                <h2 class="text-2xl font-black text-white italic uppercase tracking-tighter">ProStats <span class="text-cyan-400">Apex</span></h2>
                <p class="text-[10px] text-slate-500 mono uppercase">Sess√£o Ativa: <span id="userNameDisp" class="text-white">---</span></p>
            </div>

            <div class="flex gap-4 w-full md:w-auto">
                <select id="leagueSelect" onchange="fetchMatches()" class="bg-slate-900 border border-cyan-400/20 p-4 rounded-xl text-xs font-bold text-white mono outline-none flex-1">
                    <option value="PL" selected>üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø PREMIER LEAGUE</option>
                    <option value="BSA">üáßüá∑ BRASILEIR√ÉO A</option>
                    <option value="CL">üá™üá∫ CHAMPIONS LEAGUE</option>
                    <option value="PD">üá™üá∏ LA LIGA</option>
                    <option value="SA">üáÆüáπ SERIE A</option>
                </select>
                <button onclick="logout()" class="p-4 bg-red-500/10 text-red-500 rounded-xl hover:bg-red-500 transition-all">
                    <i class="fa-solid fa-power-off"></i>
                </button>
            </div>
        </header>

        <main id="grid" class="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-20"></main>
    </div>

    <!-- MODAL DE AN√ÅLISE -->
    <div id="modal" class="fixed inset-0 z-[10000] bg-black/95 hidden overflow-y-auto p-4 backdrop-blur-md">
        <div class="max-w-5xl mx-auto bg-slate-950 border border-cyan-400/30 rounded-[40px] overflow-hidden relative shadow-2xl my-8">
            <div class="scanline"></div>
            
            <div class="bg-cyan-400/5 p-6 border-b border-cyan-400/20 flex justify-between items-center">
                <span id="modalDateInfo" class="mono text-[10px] text-cyan-400 font-bold uppercase tracking-widest">Calculando...</span>
                <button onclick="closeModal()" class="text-slate-500 hover:text-white text-2xl transition-colors">&times;</button>
            </div>

            <div id="loading" class="p-24 text-center">
                <div class="w-12 h-12 border-2 border-cyan-400/20 border-t-cyan-400 rounded-full animate-spin mx-auto mb-6"></div>
                <p class="mono text-[10px] text-cyan-400 animate-pulse uppercase">Executando Algoritmo Poisson...</p>
            </div>

            <div id="content" class="p-8 md:p-12 hidden">
                <!-- Confronto Principal -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-10 items-center mb-16">
                    <div class="text-center">
                        <img id="hLogo" class="w-20 h-20 mx-auto mb-4 object-contain">
                        <h4 id="hName" class="text-sm font-black uppercase text-white"></h4>
                    </div>
                    <div class="text-center">
                        <div class="text-[9px] mono text-slate-500 mb-2 uppercase tracking-widest">Placar Previsto</div>
                        <div id="pScore" class="text-8xl font-black italic text-white tracking-tighter"></div>
                        <div id="pConf" class="mt-4 text-[10px] font-black text-cyan-400 mono uppercase"></div>
                    </div>
                    <div class="text-center">
                        <img id="aLogo" class="w-20 h-20 mx-auto mb-4 object-contain">
                        <h4 id="aName" class="text-sm font-black uppercase text-white"></h4>
                    </div>
                </div>

                <!-- Detalhes T√©cnicos -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                    <div class="bg-white/5 p-8 rounded-3xl border border-white/5">
                        <h5 class="mono text-[10px] text-slate-500 uppercase mb-6 tracking-widest">Matriz de Probabilidades</h5>
                        <div id="heatmap" class="grid grid-cols-6 gap-1 mb-8"></div>
                        
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-[10px] mono mb-1"><span>VIT√ìRIA MANDANTE</span><span id="winH"></span></div>
                                <div class="h-1 bg-white/5 rounded-full overflow-hidden"><div id="barH" class="h-full bg-cyan-400 transition-all duration-1000"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-[10px] mono mb-1"><span>EMPATE</span><span id="winD"></span></div>
                                <div class="h-1 bg-white/5 rounded-full overflow-hidden"><div id="barD" class="h-full bg-slate-500 transition-all duration-1000"></div></div>
                            </div>
                            <div>
                                <div class="flex justify-between text-[10px] mono mb-1"><span>VIT√ìRIA VISITANTE</span><span id="winA"></span></div>
                                <div class="h-1 bg-white/5 rounded-full overflow-hidden"><div id="barA" class="h-full bg-pink-500 transition-all duration-1000"></div></div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-cyan-400/5 p-6 rounded-3xl border border-cyan-400/20">
                            <span class="mono text-[9px] text-cyan-400 font-bold uppercase">Relat√≥rio Neural</span>
                            <p id="verdict" class="text-sm text-slate-300 leading-relaxed mt-2 italic"></p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white/5 p-6 rounded-3xl border border-white/5">
                                <span class="mono text-[9px] text-slate-500 uppercase">Handicap Proj.</span>
                                <div id="mHand" class="text-2xl font-black italic text-white"></div>
                            </div>
                            <div class="bg-white/5 p-6 rounded-3xl border border-white/5">
                                <span class="mono text-[9px] text-slate-500 uppercase">Chance Over 2.5</span>
                                <div id="mOver" class="text-2xl font-black italic text-white"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '8e3c0eba984c46a090a5c53c37835285';
        const PROXY = "https://corsproxy.io/?";
        let engine = { hData: [], aData: [], avg: 0 };
        let loginMode = true;

        // AUTH SYSTEM
        function toggleAuth() {
            loginMode = !loginMode;
            document.getElementById('authSubtitle').innerText = loginMode ? "Acesso ao Terminal" : "Novo Cadastro";
            document.getElementById('registerFields').classList.toggle('hidden');
            document.getElementById('mainBtn').innerText = loginMode ? "Entrar no Terminal" : "Finalizar Cadastro";
            document.getElementById('toggleText').innerText = loginMode ? "Novo operador? Criar conta" : "J√° tem conta? Entrar";
        }

        function handleAuth() {
            const email = document.getElementById('authEmail').value;
            const pass = document.getElementById('authPass').value;
            if(!email || !pass) return alert("Preencha os campos.");

            if(!loginMode) {
                const name = document.getElementById('regName').value;
                if(!name) return alert("Preencha o seu nome.");
                localStorage.setItem(`user_${email}`, JSON.stringify({ name, pass }));
                alert("Cadastro realizado!"); toggleAuth();
            } else {
                const stored = JSON.parse(localStorage.getItem(`user_${email}`));
                if(stored && stored.pass === pass) {
                    localStorage.setItem('session', email);
                    checkSession();
                } else alert("Credenciais inv√°lidas.");
            }
        }

        function checkSession() {
            const sessionEmail = localStorage.getItem('session');
            if(sessionEmail) {
                const user = JSON.parse(localStorage.getItem(`user_${sessionEmail}`));
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('hidden');
                document.getElementById('userNameDisp').innerText = user.name;
                fetchMatches();
            }
        }

        function logout() { localStorage.removeItem('session'); location.reload(); }

        // DATE UTILS
        function getBadgeDate(utcDate) {
            const matchDate = new Date(utcDate);
            const now = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(now.getDate() + 1);
            const time = matchDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });

            if (matchDate.toDateString() === now.toDateString()) {
                return { html: `<span class="date-badge badge-today">HOJE - ${time}</span>`, label: `HOJE √†s ${time}` };
            } else if (matchDate.toDateString() === tomorrow.toDateString()) {
                return { html: `<span class="date-badge badge-tomorrow">AMANH√É - ${time}</span>`, label: `AMANH√É √†s ${time}` };
            } else {
                const dateStr = matchDate.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
                return { html: `<span class="date-badge badge-future">${dateStr} - ${time}</span>`, label: `${dateStr} √†s ${time}` };
            }
        }

        // DATA FETCHING
        async function fetchMatches() {
            const league = document.getElementById('leagueSelect').value;
            const grid = document.getElementById('grid');
            grid.innerHTML = `<div class="col-span-full py-40 text-center mono text-cyan-400 animate-pulse uppercase tracking-[0.4em]">Sincronizando Datacenter...</div>`;

            try {
                const [resH, resA, resM] = await Promise.all([
                    fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/standings?type=HOME`, { headers: { 'X-Auth-Token': API_KEY }}),
                    fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/standings?type=AWAY`, { headers: { 'X-Auth-Token': API_KEY }}),
                    fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/matches?status=SCHEDULED`, { headers: { 'X-Auth-Token': API_KEY }})
                ]);

                const hD = await resH.json();
                const aD = await resA.json();
                const mD = await resM.json();

                engine.hData = hD.standings[0].table;
                engine.aData = aD.standings[0].table;
                
                let tg = 0, tj = 0;
                engine.hData.forEach(t => { tg += t.goalsFor; tj += t.playedGames; });
                engine.avg = tg / tj;

                grid.innerHTML = mD.matches.slice(0, 16).map(m => {
                    const badge = getBadgeDate(m.utcDate);
                    return `
                    <div onclick="analyze(${m.homeTeam.id}, ${m.awayTeam.id}, '${m.utcDate}')" class="glass p-6 rounded-[32px] cursor-pointer hover:border-cyan-400/50 transition-all group relative overflow-hidden">
                        <div class="mb-5">${badge.html}</div>
                        <div class="flex flex-col gap-4">
                            <div class="flex items-center gap-4">
                                <img src="${m.homeTeam.crest}" class="w-7 h-7 object-contain">
                                <span class="font-bold text-xs uppercase text-slate-300 group-hover:text-white">${m.homeTeam.shortName}</span>
                            </div>
                            <div class="flex items-center gap-4">
                                <img src="${m.awayTeam.crest}" class="w-7 h-7 object-contain">
                                <span class="font-bold text-xs uppercase text-slate-300 group-hover:text-white">${m.awayTeam.shortName}</span>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            } catch (e) {
                grid.innerHTML = `<div class="col-span-full text-center p-20 mono text-red-500">ERRO DE CONEX√ÉO: LIMITE DE API EXCEDIDO</div>`;
            }
        }

        // MATH ENGINE
        function factorial(n) { return (n <= 1) ? 1 : n * factorial(n - 1); }
        function poisson(k, lambda) { return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k); }

        async function analyze(hId, aId, utcDate) {
            const h = engine.hData.find(t => t.team.id === hId);
            const a = engine.aData.find(t => t.team.id === aId);
            if(!h || !a) return alert("Dados insuficientes para este confronto.");

            const modal = document.getElementById('modal');
            modal.style.display = 'block';
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('content').classList.add('hidden');
            document.getElementById('modalDateInfo').innerText = getBadgeDate(utcDate).label;

            // Simular processamento neural
            await new Promise(r => setTimeout(r, 1000));

            // Poisson Calculation
            const hAtk = (h.goalsFor / h.playedGames) / engine.avg;
            const hDef = (h.goalsAgainst / h.playedGames) / engine.avg;
            const aAtk = (a.goalsFor / a.playedGames) / engine.avg;
            const aDef = (a.goalsAgainst / a.playedGames) / engine.avg;

            const xGH = hAtk * aDef * engine.avg * 1.15; // +15% Home Advantage
            const xGA = aAtk * hDef * engine.avg;

            let probH = 0, probD = 0, probA = 0, over25 = 0, maxP = 0, bestS = "";
            const hMap = document.getElementById('heatmap');
            hMap.innerHTML = '';

            for(let i=0; i<6; i++) {
                for(let j=0; j<6; j++) {
                    const p = poisson(i, xGH) * poisson(j, xGA);
                    if(i > j) probH += p; else if(i === j) probD += p; else probA += p;
                    if(i + j > 2.5) over25 += p;
                    if(p > maxP) { maxP = p; bestS = `${i} - ${j}`; }

                    const cell = document.createElement('div');
                    cell.className = 'heatmap-cell';
                    cell.style.background = `rgba(34, 211, 238, ${Math.min(p * 5, 1)})`;
                    cell.style.color = p > 0.1 ? '#000' : '#444';
                    cell.innerText = (p*100).toFixed(0) + '%';
                    hMap.appendChild(cell);
                }
            }

            // Update UI
            document.getElementById('hLogo').src = h.team.crest;
            document.getElementById('aLogo').src = a.team.crest;
            document.getElementById('hName').innerText = h.team.shortName;
            document.getElementById('aName').innerText = a.team.shortName;
            document.getElementById('pScore').innerText = bestS;
            document.getElementById('pConf').innerText = `CONFIAN√áA: ${(maxP*450).toFixed(1)}%`;
            
            document.getElementById('winH').innerText = (probH*100).toFixed(1) + '%';
            document.getElementById('winD').innerText = (probD*100).toFixed(1) + '%';
            document.getElementById('winA').innerText = (probA*100).toFixed(1) + '%';
            
            document.getElementById('barH').style.width = (probH*100) + '%';
            document.getElementById('barD').style.width = (probD*100) + '%';
            document.getElementById('barA').style.width = (probA*100) + '%';

            document.getElementById('mHand').innerText = (xGH - xGA).toFixed(2);
            document.getElementById('mOver').innerText = (over25*100).toFixed(1) + '%';

            // Verdict Logic
            let v = "";
            if(probH > 0.5) v = `O ${h.team.shortName} entra como franco favorito. `;
            else if(probA > 0.5) v = `An√°lise aponta vantagem para o visitante ${a.team.shortName}. `;
            else v = "Confronto de alto equil√≠brio t√©cnico. ";
            
            v += over25 > 0.6 ? "Expectativa de jogo aberto com muitos gols." : "Tend√™ncia de jogo t√°tico e poucos gols.";
            document.getElementById('verdict').innerText = v;

            document.getElementById('loading').classList.add('hidden');
            document.getElementById('content').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        
        // Init
        checkSession();
    </script>
</body>
</html>
