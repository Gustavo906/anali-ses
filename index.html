<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PROSTATS APEX | Neural Analytics V5</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&family=JetBrains+Mono:wght@500;700&display=swap');
        :root { --bg: #050507; --panel: #0d0d0f; --ai: #3b82f6; --brain: #a855f7; }
        body { background-color: var(--bg); color: #e4e4e7; font-family: 'Inter', sans-serif; letter-spacing: -0.01em; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Layout de Cards */
        .glass-card { background: var(--panel); border: 1px solid #1f1f23; border-radius: 20px; padding: 24px; transition: 0.3s; cursor: pointer; }
        .glass-card:hover { border-color: var(--ai); background: #111115; }
        
        .rank-badge { background: #1a1a1e; border: 1px solid #333; padding: 2px 8px; border-radius: 6px; font-size: 11px; font-weight: 800; color: #94a3b8; }
        
        /* NOVAS BARRAS DE PROBABILIDADE GIGANTES */
        .prob-row { margin-bottom: 20px; }
        .prob-label { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px; }
        .prob-name { font-size: 10px; font-weight: 900; text-transform: uppercase; color: #71717a; letter-spacing: 0.1em; }
        .prob-value { font-size: 20px; font-weight: 900; font-family: 'JetBrains Mono'; }
        
        .huge-bar-bg { height: 12px; background: #1a1a1e; border-radius: 6px; overflow: hidden; width: 100%; border: 1px solid #27272a; }
        .huge-bar-fill { height: 100%; transition: width 1.5s cubic-bezier(0.19, 1, 0.22, 1); }

        .fill-home { background: var(--ai); box-shadow: 0 0 15px rgba(59, 130, 246, 0.4); }
        .fill-draw { background: #52525b; }
        .fill-away { background: #f8fafc; box-shadow: 0 0 15px rgba(255, 255, 255, 0.2); }

        /* Modal */
        #modal { backdrop-filter: blur(20px); z-index: 9999; }
        .log-box { background: #000; border: 1px solid #1f1f23; font-size: 9px; padding: 10px; border-radius: 8px; max-height: 120px; overflow-y: auto; color: #a855f7; }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- TOP NAVIGATION -->
    <nav class="h-16 border-b border-zinc-800 bg-black px-6 flex items-center justify-between sticky top-0 z-[100]">
        <div class="flex items-center gap-4">
            <h1 class="text-sm font-black tracking-tighter uppercase text-white">APEX <span class="text-blue-500 italic">NEURAL v5</span></h1>
            <div class="h-4 w-[1px] bg-zinc-800 hidden md:block"></div>
            <div class="hidden lg:flex items-center gap-3">
                <span class="text-[9px] mono text-purple-400 font-bold uppercase">Mem√≥ria Local Ativa</span>
                <div class="w-20 h-1 bg-zinc-800 rounded-full overflow-hidden">
                    <div id="brainBar" class="h-full bg-purple-500" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <select id="leagueSelect" onchange="syncData()" class="bg-zinc-900 border border-zinc-700 text-[10px] font-bold px-4 py-2 rounded-xl text-white outline-none focus:ring-1 ring-blue-500">
            <option value="BSA">üáßüá∑ BRASILEIR√ÉO S√âRIE A</option>
            <option value="PL">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø PREMIER LEAGUE</option>
            <option value="CL">üá™üá∫ CHAMPIONS LEAGUE (48H)</option>
            <option value="PD">üá™üá∏ LA LIGA</option>
            <option value="SA">üáÆüáπ SERIE A</option>
        </select>
    </nav>

    <!-- MAIN CONTENT -->
    <main class="flex-1 p-6 lg:p-12 max-w-7xl mx-auto w-full">
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-12">
            
            <!-- LISTA DE JOGOS -->
            <div class="lg:col-span-3">
                <div class="flex justify-between items-center mb-10 border-b border-zinc-800 pb-6">
                    <h2 class="text-3xl font-black text-white italic tracking-tighter">PR√ìXIMOS CONFRONTOS</h2>
                    <div class="text-[10px] mono text-zinc-500 bg-zinc-900 px-4 py-1.5 rounded-full border border-zinc-800 uppercase font-bold tracking-widest">
                        Scanner: <span id="matchCount" class="text-blue-500">0</span> ativos
                    </div>
                </div>
                <div id="grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                <div id="empty" class="hidden py-40 text-center text-zinc-700 italic">Buscando dados na janela de 48h...</div>
            </div>

            <!-- PAINEL LATERAL -->
            <div class="space-y-6">
                <h2 class="text-lg font-black text-white uppercase italic">Status Neural</h2>
                <div class="bg-zinc-900/40 p-6 rounded-[24px] border border-zinc-800">
                    <p class="text-[10px] mono text-zinc-500 uppercase mb-4 tracking-widest">Logs de Aprendizado</p>
                    <div id="learnLog" class="log-box mono uppercase leading-loose text-emerald-500">
                        <div>> Sincronizando rede...</div>
                    </div>
                </div>
                <div class="bg-purple-600/5 p-6 rounded-[24px] border border-purple-600/20">
                    <p class="text-[10px] mono text-purple-400 uppercase mb-1 font-bold">Experi√™ncia da IA</p>
                    <h3 id="expCount" class="text-3xl font-black text-white italic">0</h3>
                    <p class="text-[10px] text-zinc-500 mt-1 uppercase">Eventos Analisados</p>
                </div>
                <button onclick="localStorage.clear(); location.reload();" class="w-full py-4 bg-zinc-900 border border-zinc-800 text-[10px] font-bold uppercase rounded-2xl hover:bg-red-900/20 transition-all text-zinc-600 hover:text-red-400">
                    Limpar Conhecimento
                </button>
            </div>
        </div>
    </main>

    <!-- MODAL DE AN√ÅLISE PROFUNDA -->
    <div id="modal" class="fixed inset-0 hidden flex items-center justify-center p-4 bg-black/95">
        <div class="w-full max-w-5xl bg-[#0a0a0c] border border-zinc-800 rounded-[48px] overflow-hidden flex flex-col shadow-2xl max-h-[90vh]">
            
            <div class="p-8 border-b border-zinc-800 flex justify-between items-center bg-zinc-900/40">
                <div class="flex items-center gap-4">
                    <div class="px-4 py-1.5 bg-blue-600 rounded-full text-[10px] font-black uppercase text-white italic">Deep Analysis</div>
                    <span id="mDateHeader" class="text-xs mono text-zinc-500 font-bold uppercase"></span>
                </div>
                <button onclick="closeModal()" class="text-zinc-500 text-3xl hover:text-white transition-all">&times;</button>
            </div>

            <div class="p-8 lg:p-14 overflow-y-auto">
                <!-- VERSUS HEADER -->
                <div class="flex flex-col md:flex-row items-center justify-between gap-12 mb-16 pb-16 border-b border-zinc-900">
                    <div class="text-center flex-1">
                        <div class="rank-badge mb-4 inline-block"><span id="mPosH">--</span>¬∫ RANK</div>
                        <img id="mLogoH" class="w-24 h-24 mx-auto mb-6">
                        <h4 id="mNameH" class="text-2xl font-black uppercase text-white tracking-tighter">--</h4>
                    </div>

                    <div class="text-center px-10">
                        <div class="text-[10px] mono text-zinc-600 uppercase mb-4 tracking-[0.4em]">Placar IA</div>
                        <div id="mScore" class="text-9xl font-black italic text-white tracking-tighter">--</div>
                        <div id="mConf" class="mt-8 text-xs font-bold text-blue-500 mono py-2 px-6 rounded-full bg-blue-500/10 border border-blue-500/20">--</div>
                    </div>

                    <div class="text-center flex-1">
                        <div class="rank-badge mb-4 inline-block"><span id="mPosA">--</span>¬∫ RANK</div>
                        <img id="mLogoA" class="w-24 h-24 mx-auto mb-6">
                        <h4 id="mNameA" class="text-2xl font-black uppercase text-white tracking-tighter">--</h4>
                    </div>
                </div>

                <!-- ANALYTICS GRID -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">
                    
                    <!-- COLUNA ESQUERDA: BARRAS GIGANTES -->
                    <div class="space-y-10">
                        <h5 class="text-xs font-black text-zinc-500 uppercase tracking-widest border-b border-zinc-800 pb-4">Probabilidades de Vit√≥ria</h5>
                        
                        <div class="prob-row">
                            <div class="prob-label">
                                <span class="prob-name">Vit√≥ria Mandante</span>
                                <span id="mProbH" class="prob-value text-blue-500">0%</span>
                            </div>
                            <div class="huge-bar-bg"><div id="mBarH" class="huge-bar-fill fill-home" style="width: 0%"></div></div>
                        </div>

                        <div class="prob-row">
                            <div class="prob-label">
                                <span class="prob-name">Empate</span>
                                <span id="mProbD" class="prob-value text-zinc-400">0%</span>
                            </div>
                            <div class="huge-bar-bg"><div id="mBarD" class="huge-bar-fill fill-draw" style="width: 0%"></div></div>
                        </div>

                        <div class="prob-row">
                            <div class="prob-label">
                                <span class="prob-name">Vit√≥ria Visitante</span>
                                <span id="mProbA" class="prob-value text-white">0%</span>
                            </div>
                            <div class="huge-bar-bg"><div id="mBarA" class="huge-bar-fill fill-away" style="width: 0%"></div></div>
                        </div>
                    </div>

                    <!-- COLUNA DIREITA: GOLS E INSIGHTS -->
                    <div class="space-y-8">
                        <h5 class="text-xs font-black text-zinc-500 uppercase tracking-widest border-b border-zinc-800 pb-4">Gols e Tend√™ncias</h5>
                        
                        <div class="grid grid-cols-2 gap-6">
                            <div class="bg-zinc-900/50 p-6 rounded-3xl border border-zinc-800">
                                <span class="text-[9px] text-zinc-500 uppercase font-black block mb-2 tracking-widest">Chance Over 2.5</span>
                                <div id="mOver" class="text-3xl font-black text-emerald-400">0%</div>
                            </div>
                            <div class="bg-zinc-900/50 p-6 rounded-3xl border border-zinc-800">
                                <span class="text-[9px] text-zinc-500 uppercase font-black block mb-2 tracking-widest">Ambas Marcam</span>
                                <div id="mBtts" class="text-3xl font-black text-emerald-400">0%</div>
                            </div>
                        </div>

                        <div class="bg-blue-600/5 border-l-4 border-blue-600 p-8 rounded-r-3xl">
                            <h6 class="text-[10px] font-black text-blue-500 uppercase mb-4 tracking-widest">Insight Neural Apex</h6>
                            <p id="mAnalysis" class="text-lg italic text-zinc-200 leading-relaxed"></p>
                        </div>

                        <div class="pt-6 border-t border-zinc-900 flex justify-between items-center">
                            <span class="text-[10px] mono text-zinc-600 uppercase">Volume Total xG:</span>
                            <span id="mTotalXG" class="text-xl font-black text-white">0.00</span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '8e3c0eba984c46a090a5c53c37835285';
        const PROXY = "https://corsproxy.io/?";
        let engine = { table: [], leagueAvg: 0 };

        // SISTEMA DE APRENDIZADO AUT√îNOMO
        function getBrain() {
            const b = localStorage.getItem('apex_v5_brain');
            return b ? JSON.parse(b) : { learnedMatches: [], teamBias: {}, totalProcessed: 0 };
        }

        function saveBrain(b) {
            localStorage.setItem('apex_v5_brain', JSON.stringify(b));
            updateUIStats();
        }

        async function autoLearn(league) {
            const log = document.getElementById('learnLog');
            const brain = getBrain();
            try {
                const res = await fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/matches?status=FINISHED`, { headers: {'X-Auth-Token': API_KEY}});
                const data = await res.json();
                let count = 0;

                data.matches.forEach(m => {
                    if (brain.learnedMatches.includes(m.id)) return;
                    const hId = m.homeTeam.id, aId = m.awayTeam.id;
                    const sh = m.score.fullTime.home, sa = m.score.fullTime.away;
                    if (sh > sa) { brain.teamBias[hId] = (brain.teamBias[hId] || 1) * 1.03; brain.teamBias[aId] = (brain.teamBias[aId] || 1) * 0.97; }
                    else if (sa > sh) { brain.teamBias[aId] = (brain.teamBias[aId] || 1) * 1.03; brain.teamBias[hId] = (brain.teamBias[hId] || 1) * 0.97; }
                    brain.learnedMatches.push(m.id);
                    brain.totalProcessed++;
                    count++;
                });

                if (count > 0) { log.innerHTML += `<div>> +${count} RESULTADOS ABSORVIDOS.</div>`; saveBrain(brain); }
                else log.innerHTML += `<div>> RADAR ATUALIZADO.</div>`;
            } catch (e) { log.innerHTML += `<div>> AGUARDANDO LIBERA√á√ÉO API...</div>`; }
        }

        // SYNC DATA
        async function syncData() {
            const league = document.getElementById('leagueSelect').value;
            const grid = document.getElementById('grid');
            grid.innerHTML = `<div class="col-span-full py-20 text-center mono text-[10px] animate-pulse text-blue-500 uppercase tracking-[0.5em]">Iniciando Scan Neural...</div>`;
            
            autoLearn(league);

            try {
                const [resS, resM] = await Promise.all([
                    fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/standings`, { headers: {'X-Auth-Token': API_KEY}}),
                    fetch(`${PROXY}https://api.football-data.org/v4/competitions/${league}/matches?status=SCHEDULED`, { headers: {'X-Auth-Token': API_KEY}})
                ]);

                const sD = await resS.json();
                const mD = await resM.json();

                engine.table = league === 'CL' ? sD.standings.flatMap(g => g.table) : sD.standings[0].table;
                let tg = 0, tj = 0;
                engine.table.forEach(t => { tg += t.goalsFor; tj += t.playedGames; });
                engine.leagueAvg = tg / (tj || 1);

                const now = new Date();
                const limit = new Date();
                limit.setHours(now.getHours() + (league === 'CL' ? 48 : 96));

                const filtered = mD.matches.filter(m => { const d = new Date(m.utcDate); return d >= now && d <= limit; });
                document.getElementById('matchCount').innerText = filtered.length;

                if (filtered.length === 0) { grid.innerHTML = ""; document.getElementById('empty').classList.remove('hidden'); return; }

                document.getElementById('empty').classList.add('hidden');
                grid.innerHTML = filtered.map(m => {
                    const h = engine.table.find(t => t.team.id === m.homeTeam.id);
                    const a = engine.table.find(t => t.team.id === m.awayTeam.id);
                    const matchDate = new Date(m.utcDate);
                    const dateStr = matchDate.toLocaleDateString('pt-BR', {day:'2-digit', month:'2-digit'}) + " √†s " + matchDate.toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});

                    return `
                    <div onclick="openAnalysis(${m.homeTeam.id}, ${m.awayTeam.id}, '${m.utcDate}')" class="glass-card">
                        <div class="flex justify-between items-center mb-6">
                            <span class="text-[10px] mono text-zinc-600 font-bold uppercase tracking-widest">${dateStr}</span>
                            <div class="flex gap-2">
                                <span class="rank-badge">${h ? h.position : '?'}¬∫</span>
                                <span class="rank-badge text-blue-500">${a ? a.position : '?'}¬∫</span>
                            </div>
                        </div>
                        <div class="space-y-4">
                            <div class="flex items-center gap-4">
                                <img src="${m.homeTeam.crest}" class="w-8 h-8 object-contain">
                                <span class="text-sm font-black uppercase text-white">${m.homeTeam.shortName}</span>
                            </div>
                            <div class="flex items-center gap-4">
                                <img src="${m.awayTeam.crest}" class="w-8 h-8 object-contain">
                                <span class="text-sm font-black uppercase text-white">${m.awayTeam.shortName}</span>
                            </div>
                        </div>
                    </div>`;
                }).join('');
            } catch (e) { grid.innerHTML = `<div class="col-span-full py-10 text-red-500 text-center mono text-xs">LIMITE DE API ATINGIDO. AGUARDE 60s.</div>`; }
        }

        // MOTOR POISSON
        function factorial(n) { return n <= 1 ? 1 : n * factorial(n - 1); }
        function poisson(k, lambda) { return (Math.pow(lambda, k) * Math.exp(-lambda)) / factorial(k); }

        function openAnalysis(hId, aId, utcDate) {
            const h = engine.table.find(t => t.team.id === hId);
            const a = engine.table.find(t => t.team.id === aId);
            if(!h || !a) return;

            const brain = getBrain();
            const hBias = brain.teamBias[hId] || 1;
            const aBias = brain.teamBias[aId] || 1;

            const xGH = ((h.goalsFor/h.playedGames)/engine.leagueAvg) * ((a.goalsAgainst/a.playedGames)/engine.leagueAvg) * engine.leagueAvg * 1.15 * hBias;
            const xGA = ((a.goalsFor/a.playedGames)/engine.leagueAvg) * ((h.goalsAgainst/h.playedGames)/engine.leagueAvg) * engine.leagueAvg * aBias;

            let pH = 0, pD = 0, pA = 0, over2 = 0, btts = 0, maxP = 0, bestS = "";
            for(let i=0; i<6; i++) {
                for(let j=0; j<6; j++) {
                    const p = poisson(i, xGH) * poisson(j, xGA);
                    if(i > j) pH += p; else if(i === j) pD += p; else pA += p;
                    if(i + j > 2.5) over2 += p;
                    if(i > 0 && j > 0) btts += p;
                    if(p > maxP) { maxP = p; bestS = `${i} - ${j}`; }
                }
            }

            document.getElementById('modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';

            document.getElementById('mLogoH').src = h.team.crest;
            document.getElementById('mLogoA').src = a.team.crest;
            document.getElementById('mNameH').innerText = h.team.shortName;
            document.getElementById('mNameA').innerText = a.team.shortName;
            document.getElementById('mPosH').innerText = h.position;
            document.getElementById('mPosA').innerText = a.position;
            document.getElementById('mScore').innerText = bestS;
            document.getElementById('mConf').innerText = "CONFIAN√áA MATEM√ÅTICA: " + (maxP * 100).toFixed(1) + "%";
            document.getElementById('mDateHeader').innerText = new Date(utcDate).toLocaleString();

            // Atualiza Barras Gigantes
            document.getElementById('mProbH').innerText = (pH*100).toFixed(1) + '%';
            document.getElementById('mProbD').innerText = (pD*100).toFixed(1) + '%';
            document.getElementById('mProbA').innerText = (pA*100).toFixed(1) + '%';
            document.getElementById('mBarH').style.width = (pH*100) + '%';
            document.getElementById('mBarD').style.width = (pD*100) + '%';
            document.getElementById('mBarA').style.width = (pA*100) + '%';

            document.getElementById('mOver').innerText = (over2 * 100).toFixed(1) + '%';
            document.getElementById('mBtts').innerText = (btts * 100).toFixed(1) + '%';
            document.getElementById('mTotalXG').innerText = (xGH + xGA).toFixed(2);

            let n = "";
            const diff = h.position - a.position;
            if (pH > 0.55 && diff > 5) {
                n = `OPORTUNIDADE CONTRA O RANK: O ${h.team.shortName} est√° em ${h.position}¬∫, mas as m√©tricas de xG sugerem um favoritismo oculto. O aprendizado da IA aplicou um vi√©s de ${hBias.toFixed(2)}x confirmando que o mercado de apostas est√° ignorando a for√ßa real do mandante.`;
            } else if (pH > 0.65) {
                n = `DOM√çNIO CONFIRMADO: O mandante possui uma expectativa ofensiva de elite. A probabilidade de zebra √© reduzida devido √† consist√™ncia defensiva do time melhor ranqueado. Entrada segura em vit√≥ria direta.`;
            } else {
                n = `EQUIL√çBRIO T√ÅTICO: Confronto decidido por detalhes. A simula√ß√£o aponta para um xG Total de ${(xGH+xGA).toFixed(2)}. O empate √© o resultado de maior valor oculto para este cen√°rio.`;
            }
            document.getElementById('mAnalysis').innerText = n;
        }

        function updateUIStats() {
            const b = getBrain();
            document.getElementById('brainBar').style.width = Math.min(b.totalProcessed, 100) + '%';
            document.getElementById('expCount').innerText = b.totalProcessed;
        }

        function closeModal() { document.getElementById('modal').classList.add('hidden'); document.body.style.overflow = 'auto'; }
        window.onload = () => { syncData(); updateUIStats(); };
    </script>
</body>
</html>
